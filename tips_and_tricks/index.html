
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="From one data scientist to another on how to utilize docker to make your life easier">
      
      
      
        <link rel="canonical" href="https://www.data-mining.co.nz/docker-for-data-scientists/tips_and_tricks/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Tips & Tricks - Docker for Data Scientists</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#remove-unwanted-files" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Docker for Data Scientists" class="md-header__button md-logo" aria-label="Docker for Data Scientists" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docker for Data Scientists
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tips & Tricks
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/waikato-datamining/docker-for-data-scientists" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Docker for Data Scientists" class="md-nav__button md-logo" aria-label="Docker for Data Scientists" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Docker for Data Scientists
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/waikato-datamining/docker-for-data-scientists" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../basics/" class="md-nav__link">
        Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../repos/" class="md-nav__link">
        Repositories
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../dockerfile/" class="md-nav__link">
        Dockerfile
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../best_practices/" class="md-nav__link">
        Best practices
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tips & Tricks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tips & Tricks
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#remove-unwanted-files" class="md-nav__link">
    Remove unwanted files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    Python
  </a>
  
    <nav class="md-nav" aria-label="Python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternative-python-version" class="md-nav__link">
    Alternative Python version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-default-python-version" class="md-nav__link">
    Switch default Python version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-packages-with-pip-ignoring-errors" class="md-nav__link">
    Install packages with pip ignoring errors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#screen" class="md-nav__link">
    Screen
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-runtime" class="md-nav__link">
    Default runtime
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rebuild" class="md-nav__link">
    Rebuild
  </a>
  
    <nav class="md-nav" aria-label="Rebuild">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rebuilding-some-layers" class="md-nav__link">
    Rebuilding some layers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-rebuild" class="md-nav__link">
    Complete rebuild
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thorough-clean-up" class="md-nav__link">
    Thorough clean up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#excluding-filesdirs-from-docker-context" class="md-nav__link">
    Excluding files/dirs from docker context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-gpu" class="md-nav__link">
    Testing the GPU
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment variables
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../automation/" class="md-nav__link">
        Automation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../registry/" class="md-nav__link">
        Registry
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#remove-unwanted-files" class="md-nav__link">
    Remove unwanted files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    Python
  </a>
  
    <nav class="md-nav" aria-label="Python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternative-python-version" class="md-nav__link">
    Alternative Python version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-default-python-version" class="md-nav__link">
    Switch default Python version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-packages-with-pip-ignoring-errors" class="md-nav__link">
    Install packages with pip ignoring errors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#screen" class="md-nav__link">
    Screen
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-runtime" class="md-nav__link">
    Default runtime
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rebuild" class="md-nav__link">
    Rebuild
  </a>
  
    <nav class="md-nav" aria-label="Rebuild">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rebuilding-some-layers" class="md-nav__link">
    Rebuilding some layers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-rebuild" class="md-nav__link">
    Complete rebuild
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thorough-clean-up" class="md-nav__link">
    Thorough clean up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#excluding-filesdirs-from-docker-context" class="md-nav__link">
    Excluding files/dirs from docker context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-gpu" class="md-nav__link">
    Testing the GPU
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment variables
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/waikato-datamining/docker-for-data-scientists/edit/main/docs/tips_and_tricks.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>Tips & Tricks</h1>

<h2 id="remove-unwanted-files">Remove unwanted files<a class="headerlink" href="#remove-unwanted-files" title="Permanent link">#</a></h2>
<p>Especially during development, it can happen that files get generated when running
your docker container that can only be removed by the <code>root</code> user again. If you 
do not have admin permissions (e.g., via <code>sudo</code>) on the machine then you can 
revert to using docker to remove them again:</p>
<ul>
<li>
<p>change into the directory with unwanted files and/or directories</p>
</li>
<li>
<p>the following docker command will map the current directory to <code>/workspace</code>:</p>
<p><code>docker run --rm -v `pwd`:/workspace -it bash:5.1.8</code></p>
</li>
<li>
<p>change into <code>/workspace</code> and remove all files/dirs (or just the files that need removing):</p>
<p><code>cd /workspace
rm -Rf *</code></p>
</li>
</ul>
<h2 id="python">Python<a class="headerlink" href="#python" title="Permanent link">#</a></h2>
<h3 id="alternative-python-version">Alternative Python version<a class="headerlink" href="#alternative-python-version" title="Permanent link">#</a></h3>
<p>In case your base Debian/Ubuntu distribution does not have the right Python version 
available, you can get additional versions by adding the <a href="https://launchpad.net/~deadsnakes/+archive/ubuntu/ppa">deadsnakes ppa</a>:</p>
<pre><code class="language-bash">add-apt-repository -y ppa:deadsnakes/ppa &amp;&amp; \
apt-get update
</code></pre>
<p><strong>Notes:</strong> </p>
<ul>
<li>You may need to install package <code>software-properties-common</code> before you have <code>add-apt-repository</code> available.</li>
<li>Consider installed <code>python3.x-full</code> and <code>libpython3.x</code> to also get the <code>venv</code> and <code>distutils</code> packages installed.</li>
<li>
<p>For installing <code>pip</code>, use this:</p>
<p><code>wget https://bootstrap.pypa.io/get-pip.py -O /tmp/get-pip.py &amp;&amp; \
python3.7 /tmp/get-pip.py &amp;&amp; \
rm /tmp/get-pip.py</code></p>
</li>
</ul>
<h3 id="switch-default-python-version">Switch default Python version<a class="headerlink" href="#switch-default-python-version" title="Permanent link">#</a></h3>
<p>If your base distro has an older version of Python and you do not want to sprinkle the
specific newer version throughout your <code>Dockerfile</code>, then you can use <code>update-alternatives</code>
on Debian systems to change the default.</p>
<p>The following commands switch from Python 3.5 to Python 3.6 for the <code>python3</code> executable
and also use Python 3.6 as the default for the <code>python</code> executable:</p>
<pre><code class="language-commandline">update-alternatives --install /usr/bin/python python /usr/bin/python3.5 1 &amp;&amp; \
update-alternatives --install /usr/bin/python python /usr/bin/python3.6 2 &amp;&amp; \
update-alternatives --set python /usr/bin/python3.6 &amp;&amp; \
update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.5 1 &amp;&amp; \
update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.6 2 &amp;&amp; \
update-alternatives --set python3 /usr/bin/python3.6 &amp;&amp; \
</code></pre>
<h3 id="install-packages-with-pip-ignoring-errors">Install packages with pip ignoring errors<a class="headerlink" href="#install-packages-with-pip-ignoring-errors" title="Permanent link">#</a></h3>
<p>An installation with <code>pip</code> will fail if a dependency is not available, even if that dependency should not be required.
The following command-line install each dependency separately, therefore continuing, even if errors are encountered (<a href="https://stackoverflow.com/a/54053100">source</a>):</p>
<pre><code>cat requirements.txt | sed -e '/^\s*#.*$/d' -e '/^\s*$/d' | xargs -n 1 pip install
</code></pre>
<h2 id="screen">Screen<a class="headerlink" href="#screen" title="Permanent link">#</a></h2>
<p>The <a href="https://linux.die.net/man/1/screen">screen</a> command-line utility allows you to 
pick up remote sessions after detaching from them. This is especially helpful when 
running docker in interactive mode via ssh sessions. If such an ssh session should
accidentally close (e.g., internet connection lost, laptop closed), then the
docker command would terminate as well.</p>
<p>On the remote host, <strong>start</strong> the <code>screen</code> command before you launch your docker command 
(you can run multiple <code>screen</code> instances as well) and skip the screen with the licenses 
etc using <code>Enter</code> or <code>Space</code>. Now you can start up the actual command. If you want to 
run multiple screen sessions on the same host, then you should name them using the 
<code>-S sessionname</code> option to easily distinguish them. </p>
<p>When running multiple sessions on a single host that use the auto-generated names, 
it can get difficult to distinguish them. You can use 
<code>screen -S &lt;PID&gt;.&lt;sessionName&gt; -X sessionname &lt;newSessionName&gt;</code> to rename an 
existing session to use a more suitable name (<a href="https://www.shellhacks.com/screen-rename-session/">source</a>).</p>
<p>For <strong>detaching</strong> a session, use the <code>CTRL+A+D</code> key combination. This will leave your 
process running in the background and you can close the remote connection.</p>
<p>In order to <strong>reconnect</strong>, simply ssh into the remote host and run <code>screen -r</code>. If there
is only one screen session running, then it will automatically reconnect. Otherwise, it
will output a list of available sessions. Supply the name of the session that you want to 
reattach to the <code>-r</code> option. In case a session got interrupted and not properly detached,
use the <code>-d</code> flag to first detach it.</p>
<p>You can <strong>exit</strong> a screen session by either typing <code>exit</code> or using <code>CTRL+D</code> (just like
with a <code>bash</code> shell).</p>
<p>If you need to increase the scrollback buffer, let us say to 100,000 lines, then you can do it</p>
<ul>
<li>
<p>in the current session as follows:</p>
<p><code>CTRL A : &lt;Enter&gt;
scrollback 100000&lt;Enter&gt;</code></p>
</li>
<li>
<p>for all new sessions by adding the following line in your <code>$HOME/.screenrc</code> config file:</p>
<p><code>defscrollback 100000</code></p>
</li>
</ul>
<h2 id="default-runtime">Default runtime<a class="headerlink" href="#default-runtime" title="Permanent link">#</a></h2>
<p>Instead of always having to type <code>--runtime=nvidia</code> or <code>--gpus=all</code>, you can simply define
the <em>default runtime</em> to use with your docker commands (<a href="https://docs.nvidia.com/dgx/nvidia-container-runtime-upgrade/index.html">source</a>):</p>
<ul>
<li>edit the <code>/etc/docker/daemon.json</code> file as <code>root</code> user</li>
<li>insert the key <code>default-runtime</code> with value <code>nvidia</code> so that it looks something like this:</li>
</ul>
<pre><code class="language-json">{
    &quot;default-runtime&quot;: &quot;nvidia&quot;,
    &quot;runtimes&quot;: {
        &quot;nvidia&quot;: {
            &quot;path&quot;: &quot;nvidia-container-runtime&quot;,
            &quot;runtimeArgs&quot;: []
        }
    }
}
</code></pre>
<ul>
<li>save the file</li>
<li>restart the docker daemon (e.g., <code>sudo systemctl restart docker</code>)</li>
</ul>
<h2 id="rebuild">Rebuild<a class="headerlink" href="#rebuild" title="Permanent link">#</a></h2>
<h3 id="rebuilding-some-layers">Rebuilding some layers<a class="headerlink" href="#rebuilding-some-layers" title="Permanent link">#</a></h3>
<p>Since docker hashes the layer instructions rather than the content, it will not detect changes to a file 
(e.g., modifications in a script) since the last build and will keep using the cached version of that layer.</p>
<p>Assuming the following <code>Dockerfile</code> snippet, where <code>file1</code> changed:</p>
<pre><code>RUN ...&lt;layer X&gt;...
COPY file1 ...&lt;layer X+1&gt;...
COPY file2 ...&lt;layer X+2&gt;...
</code></pre>
<p>You can <strong>inject</strong> a dummy <strong>ARG</strong> variable as follows to rebuild the layers from <code>layer X+1</code> onwards:</p>
<pre><code>RUN ...&lt;layer X&gt;...
ARG blah=1
COPY file1 ...&lt;layer X+1&gt;...
COPY file2 ...&lt;layer X+2&gt;...
</code></pre>
<p>Every time you need rebuild from there on, simply change the value that you are assigning to the variable, 
to change the hash value.</p>
<p>Of course, once your <code>Dockerfile</code> has been finalized, you can remove all these unnecessary operations and
build your image properly.</p>
<h3 id="complete-rebuild">Complete rebuild<a class="headerlink" href="#complete-rebuild" title="Permanent link">#</a></h3>
<p>Especially during development of a docker image, it can happen that library versions have not been added to the <code>Dockerfile</code> just yet. Since docker hashes the command-lines, it will not rebuild a layer (and subsequent ones) if the hash does not change. If you do not want to clear your complete system (due to time constraints or capped internet usage), then you can force docker to build the image without using the hashed layers by adding the following flag to your <a href="https://docs.docker.com/engine/reference/commandline/build/">build</a> command:</p>
<pre><code>--no-cache
</code></pre>
<h2 id="thorough-clean-up">Thorough clean up<a class="headerlink" href="#thorough-clean-up" title="Permanent link">#</a></h2>
<p>You can stop/remove all containers and images with this one-liner:</p>
<pre><code class="language-bash">docker stop $(docker ps -a -q) &amp;&amp; docker rm $(docker ps -a -q) &amp;&amp; docker system prune -a
</code></pre>
<p>If you need to remove dangling volumes, use this:</p>
<pre><code class="language-commandline">docker volume prune
</code></pre>
<h2 id="excluding-filesdirs-from-docker-context">Excluding files/dirs from docker context<a class="headerlink" href="#excluding-filesdirs-from-docker-context" title="Permanent link">#</a></h2>
<p>By default, docker will use all files and directories within the directory that contains the <code>Dockerfile</code> to
the daemon to use as <em>context</em>. From this context, the image gets built. Should you have test data/models
in the same directory then this could mean sending quite a lot of unnecessary data to the daemon. To avoid this,
you can take advantage of the <code>.dockerignore</code> file, which lists files and directories to ignore. The following
example ignores the <code>test</code> directory and all vim backup files:</p>
<pre><code>test/
*~
</code></pre>
<p>For more information, see the official documentation on the <a href="https://docs.docker.com/engine/reference/builder/#dockerignore-file">dockerignore file</a>.</p>
<h2 id="testing-the-gpu">Testing the GPU<a class="headerlink" href="#testing-the-gpu" title="Permanent link">#</a></h2>
<p>Images from the <a href="https://github.com/waikato-datamining/gpu-test">gpu-test</a> repository
can be used to quickly test whether Docker containers can access the GPU properly.</p>
<p>The following command, based on CUDA 12.2.2, should simply run <code>nvidia-smi</code> within
the container and output some information on the available GPUs (RAM, load, etc):</p>
<pre><code>docker run --rm \
  --gpus=all \
  -it waikatodatamining/gpu-test:cuda12.2.2
</code></pre>
<p>If the GPU is not passed through correctly (e.g., due to mismatching drivers, etc), 
an error message will get output instead. Here is an example of such an error:</p>
<pre><code>docker: Error response from daemon: could not select device driver &quot;&quot; with capabilities: [[gpu]].
</code></pre>
<h2 id="environment-variables">Environment variables<a class="headerlink" href="#environment-variables" title="Permanent link">#</a></h2>
<p>You can provide environment variables via a <a href="https://hexdocs.pm/dotenvy/0.2.0/dotenv-file-format.html">.env file</a>
to your Docker container without having to provide them as parameters. That approach
avoids having variables like access tokens appear in your command history, leaking
sensitive information.</p>
<p>A <code>.env</code> file is basically a file with one <code>key=value</code> pair per line, with the
<code>key</code> being the name of the environment variable and <code>value</code> the associated
value of the variable.</p>
<p>If you have such a <code>.env</code> in the directory that you are starting the container from,
you can make them available with the following option of the <code>docker run</code> command:</p>
<pre><code>--env-file=`pwd`/.env
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../best_practices/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Best practices" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Best practices
            </div>
          </div>
        </a>
      
      
        
        <a href="../troubleshooting/" class="md-footer__link md-footer__link--next" aria-label="Next: Troubleshooting" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Troubleshooting
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>