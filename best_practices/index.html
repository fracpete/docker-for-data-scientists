
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="From one data scientist to another on how to utilize docker to make your life easier">
      
      
      
        <link rel="canonical" href="https://www.data-mining.co.nz/docker-for-data-scientists/best_practices/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Best practices - Docker for Data Scientists</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#versioning" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Docker for Data Scientists" class="md-header__button md-logo" aria-label="Docker for Data Scientists" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docker for Data Scientists
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Best practices
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/waikato-datamining/docker-for-data-scientists" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Docker for Data Scientists" class="md-nav__button md-logo" aria-label="Docker for Data Scientists" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Docker for Data Scientists
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/waikato-datamining/docker-for-data-scientists" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../basics/" class="md-nav__link">
        Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../repos/" class="md-nav__link">
        Repositories
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../dockerfile/" class="md-nav__link">
        Dockerfile
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Best practices
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Best practices
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#versioning" class="md-nav__link">
    Versioning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-group" class="md-nav__link">
    Docker group
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launch-container-as-regular-user" class="md-nav__link">
    Launch container as regular user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#no-anaconda" class="md-nav__link">
    No Anaconda
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up-pip" class="md-nav__link">
    Clean up pip
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up-apt" class="md-nav__link">
    Clean up apt
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caching-models" class="md-nav__link">
    Caching models
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tips_and_tricks/" class="md-nav__link">
        Tips & Tricks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../automation/" class="md-nav__link">
        Automation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../registry/" class="md-nav__link">
        Registry
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#versioning" class="md-nav__link">
    Versioning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-group" class="md-nav__link">
    Docker group
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launch-container-as-regular-user" class="md-nav__link">
    Launch container as regular user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#no-anaconda" class="md-nav__link">
    No Anaconda
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up-pip" class="md-nav__link">
    Clean up pip
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up-apt" class="md-nav__link">
    Clean up apt
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caching-models" class="md-nav__link">
    Caching models
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/waikato-datamining/docker-for-data-scientists/edit/main/docs/best_practices.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>Best practices</h1>

<h2 id="versioning">Versioning<a class="headerlink" href="#versioning" title="Permanent link">#</a></h2>
<p>Since docker determines by the hash of a command whether this particular layer needs
rebuilding, you should, wherever possible, specify the version of the library that
you are installing. That way, whenever you upgrade a library, that layer (and all 
subsequent ones) will get rebuilt. The added bonus is that you will not accidentally 
rebuild the image with a newer version of a library at a later stage that may now be 
incompatible with all the others (<em>Yeah, I'm looking at you, numpy</em>!).</p>
<p>So instead of:</p>
<pre><code class="language-commandline">RUN python3 -m pip install --no-cache-dir numpy &amp;&amp; \
    ... 
</code></pre>
<p>You should do something like this:</p>
<pre><code class="language-commandline">RUN python3 -m pip install --no-cache-dir numpy==1.17.4 &amp;&amp; \
    ... 
</code></pre>
<p>Of course, when you are cloning directly from a github repository, because you require
a specific bugfix or the library does not offer any releases (or only very infrequent),
then you should use a specific commit hash in your command:  </p>
<pre><code class="language-commandline">RUN git clone https://github.com/ACCOUNT/REPO.git &amp;&amp; \
    cd REPO &amp;&amp; \
    git reset --hard 11223344556677889900AABBCCDDEEFF11223344 &amp;&amp; \
    ...
</code></pre>
<h2 id="docker-group">Docker group<a class="headerlink" href="#docker-group" title="Permanent link">#</a></h2>
<p>Instead of running the <code>docker</code> command via <code>sudo</code>, you should consider adding your user
to the <code>docker</code> group instead (in <code>/etc/group</code>). That way, you can run the <code>docker</code> 
command as a regular user.</p>
<h2 id="launch-container-as-regular-user">Launch container as regular user<a class="headerlink" href="#launch-container-as-regular-user" title="Permanent link">#</a></h2>
<p>Once development of your docker image has finished, you should avoid running docker 
containers as the <code>root</code> user and instead run it as the current user (which also 
avoids creating output files in volumes that can only be removed by <code>root</code>).</p>
<p>Use the <code>-u</code> and <code>-e</code> command to specify the user/group IDs and the user name 
as follows:</p>
<pre><code>docker run -u $(id -u):$(id -g) -e USER=$USER ...
</code></pre>
<p>However, the environment variables for you command prompt (when you are using your
container in interactive mode) may not be able to handle this properly. In such a
case you will get output similar to this: </p>
<pre><code>groups: cannot find name for group ID XYZ
I have no name!@c7355d9a1b59:/$ 
</code></pre>
<p>You can rectify this by creating a custom <code>bash.bashrc</code>file using the 
<a href="https://github.com/waikato-datamining/docker-banner-gen">docker-banner-gen</a> library
(which not only outputs a nice banner, but also warns you in case you are running
the container as <code>root</code>).</p>
<p>This custom file can then be added to your docker image using the following command:</p>
<pre><code class="language-commandline">COPY bash.bashrc /etc/bash.bashrc
</code></pre>
<h2 id="no-anaconda">No Anaconda<a class="headerlink" href="#no-anaconda" title="Permanent link">#</a></h2>
<p>Instead of using <a href="https://www.anaconda.com/products/individual">Anaconda</a> for installing
Python packages, you can just use plain <code>pip</code> to install packages from the <a href="https://pypi.org/">Python Package Index</a>.
Anaconda in itself is quite a large installation and will increase the overall docker
image size unnecessarily.</p>
<h2 id="clean-up-pip">Clean up pip<a class="headerlink" href="#clean-up-pip" title="Permanent link">#</a></h2>
<p>Remove the pip cache to reduce the size of your layer after you have installed all your packages:</p>
<pre><code>rm -Rf /root/.cache/pip
</code></pre>
<p>Alternatively, do not cache downloads when installing a package:</p>
<pre><code>pip install --no-cache-dir ...
</code></pre>
<h2 id="clean-up-apt">Clean up apt<a class="headerlink" href="#clean-up-apt" title="Permanent link">#</a></h2>
<p>After performing installs via <code>apt</code> or <code>apt-get</code>, clean up the cache to reduce the 
size of your layer:</p>
<pre><code>apt-get clean &amp;&amp; \
rm -rf /var/lib/apt/lists/*
</code></pre>
<h2 id="caching-models">Caching models<a class="headerlink" href="#caching-models" title="Permanent link">#</a></h2>
<p>As soon as you stop/remove the container, all modifications will be lost. This also includes
any pretrained networks that any of the deep learning frameworks downloaded into its cache.
In order to avoid the constant downloads, you can map the cache directories for the relevant
framework to a local directory on the host:</p>
<p><strong>PyTorch</strong></p>
<ul>
<li>
<p>when running the container as <code>root</code>:</p>
<p><code>-v /some/where/cache:/root/.torch \</code></p>
</li>
<li>
<p>when running the container as regular user:</p>
<p><code>-v /some/where/cache:/.torch \</code></p>
</li>
</ul>
<p><strong>Keras</strong></p>
<ul>
<li>
<p>Map the cache directory (<code>/root/.keras</code>) when running container as <code>root</code>:</p>
<p><code>-v /some/where/cache:/root/.keras</code></p>
</li>
<li>
<p>Or when running as regular user (<code>/tmp/.keras</code>):</p>
<p><code>-v /some/where/cache:/tmp/.keras</code></p>
</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../dockerfile/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Dockerfile" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Dockerfile
            </div>
          </div>
        </a>
      
      
        
        <a href="../tips_and_tricks/" class="md-footer__link md-footer__link--next" aria-label="Next: Tips &amp; Tricks" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Tips & Tricks
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>